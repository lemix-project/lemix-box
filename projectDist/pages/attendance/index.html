<!doctype html><html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1,minimum-scale=1"><meta http-equiv="X-UA-Compatible" content="ie=edge"><style>*{margin:0;padding:0}#content{width:100%;height:100%}#content .location{width:100%;height:305px;background-size:100%;z-index:1;position:relative}#content .location .takephoto-view{width:100%;height:90px;display:-webkit-flex;-webkit-align-items:center;-webkit-justify-content:center;margin:25px 0;position:relative}#content .location .takephoto-view .takephoto{width:85px;height:85px;line-height:85px;text-align:center;border-radius:50%;background:rgba(0,0,0,.7)}#content .photo-view{width:70%;height:50%;background:#fefefe;border:5px solid #606060;box-shadow:0 0 1px 0 rgba(255,255,255,.5);position:absolute;top:35%;left:50%;z-index:2;transform:translate(-50%,0);display:-webkit-flex;-webkit-flex-direction:column;-webkit-align-items:center}#content .sub-mes{width:100%;height:40px;line-height:40px;text-align:center;position:absolute;bottom:5%;padding:0 20px}#content .sub-mes .type{background:#ccc;border-radius:8px;color:#fff}.mui-popup{border-radius:5px 5px 0 0!important;border-top:3px solid #5db7ea}.mui-popup .mui-popup-inner{border-radius:0}.mui-popup .mui-popup-inner .mui-popup-title{display:none}.mui-popup .mui-popup-inner .mui-popup-text{font-size:16px}.mui-popup .mui-popup-buttons .mui-popup-button{color:#7d7d7d;font-weight:400;font-size:16px}.mui-popup .mui-popup-buttons .mui-popup-button:first-child:last-child{border-radius:0}.mui-popup .mui-popup-buttons .mui-popup-button:first-child{border-radius:0}</style><link rel="stylesheet" href="../../static/mui/mui.min.css"><link rel="stylesheet" href="../../static/iconfont.css"><script src="../../static/mui/mui.min.js"></script><title>忠旺考勤</title></head><body><div id="content"><div class="location" id="location_style"><img src="../../static/bg.png" style="width:100%;height:100%;position:absolute;top:0;left:0;z-index:-1"><div style="width:100%;text-align:center;font-size:18px;color:#fff;position:relative;display:flex;justify-content:center;align-items:center"><div style="width:70%;padding:10px 10px 0 10px" id="locationName">正在定位中...</div></div><div style="width:44px;height:44px;color:#fff;position:absolute;left:5px;display:flex;justify-content:center;align-items:center" class="icon-view" id="back-view"><span class="mui-icon mui-icon-back"></span></div><div style="width:100%;height:25px;line-height:25px;text-align:center;font-size:14px;color:#c2c2c2" id="showDateTime"></div><div class="takephoto-view"><div class="takephoto" id="btn"><i class="iconfont" style="font-size:40px;color:#fff">&#xe653;</i></div></div></div><div class="photo-view"><img alt="" style="width:100%;height:100%;position:absolute;top:0;left:0" id="imgUrl"><div style="width:55px;height:30px;margin-top:50px;line-height:30px;text-align:center"><i class="iconfont" style="font-size:30px;color:#e9e9e9">&#xe654;</i></div><div style="width:100%;height:30px;margin-top:50px;text-align:center;color:#a2a2a2">请点击上方拍照按钮进行拍照</div></div><div class="sub-mes"><div class="type" id="goback">提交打卡</div></div></div><script>"use strict";var lon,center_longitude,lat,center_latitude,radius_limit,iscenter,moment_time,workType,errorMessage,CLICKTAG=0;function getArea(){var e=$lemix.data.storage.getLocalStorage({key:"sessionId"}),i=window;$zwt_sdk.network.http("http://192.168.12.53:31023/att/areas/query/user_code",{async:!0,dataType:"json",type:"get",headers:{"Content-Type":"application/json","X-SESSION-ID":e},success:function(e,t,n){for(var a=0;a<e.length&&(i.center_latitude=e[a].center_latitude,i.center_longitude=e[a].center_longitude,i.radius_limit=e[a].radius_limit,GetDistance(),"yes"!==iscenter);a++);errorMessage&&mui.alert(errorMessage,"","我知道了",function(){})},error:function(e,t,n){var a=JSON.parse(e.response);errorMessage="ATT_SRV_EXECUTE_ERROR"===a.code?"您所属组织机构尚未指定打卡区域":a.message,mui.alert(errorMessage,"","我知道了",function(){})}})}function showDateTime(){var e=document.getElementById("showDateTime"),t=new Date,n=t.getMonth()+1,a=t.getHours();a<10&&(a="0"+a);var i=t.getMinutes();i<10&&(i="0"+i);var o=t.getSeconds();o<10&&(o="0"+o);var r=t.getFullYear()+"-"+n+"-"+t.getDate()+" "+a+":"+i+":"+o;e.innerHTML=r,moment_time=r}function getImgUrl(){$lemix.image.camera.openCamera({mode:"photo",theme:"#66CC00",maxLength:5,success:function(e){document.getElementById("imgUrl").src=e},failed:function(e){}})}function getPkid(){$lemix.call.customs.callCustom({type:"getPkid",imgUrl:document.getElementById("imgUrl").src,success:function(e){"上传失败"===e?(mui.alert("上传图片失败","","我知道了",function(){}),CLICKTAG=0):submit(e)}})}function submit(e){var t=$lemix.data.storage.getLocalStorage({key:"sessionId"});$zwt_sdk.network.http("http://192.168.12.53:31023/att/attendances",{data:{att_remark:"打卡",attendance_gps_latitude:lat,attendance_gps_longitude:lon,attendance_picture_uuid:e,attendance_time:moment_time,attendance_type:workType},async:!0,dataType:"json",type:"post",headers:{"Content-Type":"application/json","X-SESSION-ID":t},success:function(e,t,n){mui.alert("打卡成功","","我知道了",function(){}),$lemix.ui.navigation.pop()},error:function(e,t,n){CLICKTAG=0,mui.alert("提交打卡失败","","我知道了",function(){})}})}function rad(e){return e*Math.PI/180}function GetDistance(){var e=rad(center_longitude),t=rad(lon),n=e-t,a=rad(center_latitude)-rad(lat),i=2*Math.asin(Math.sqrt(Math.pow(Math.sin(n/2),2)+Math.cos(e)*Math.cos(t)*Math.pow(Math.sin(a/2),2)));i*=6378.137,(i=Math.round(1e4*i)/10)<radius_limit?(iscenter="yes",document.getElementById("goback").style.background="#5D5D5D"):errorMessage="您不在打卡区域内,无法进行打卡操作！"}window.__onload=function(e){iscenter="no",workType=e,$lemix.map.location.getLocation({success:function(e,t,n){document.getElementById("locationName").innerHTML=n,window.lon=e,window.lat=t,getArea()},failed:function(e){}}),$lemix.ui.style.getNavigationBarHeight({success:function(e){document.getElementById("location_style").style.paddingTop=e+"px",document.getElementById("back-view").style.top=e+"px"}})},window.onload=function(){showDateTime(),setInterval(function(){showDateTime()},1e3)},mui(".takephoto-view").on("tap","#btn",function(e){getImgUrl()}),mui(".photo-view").on("tap","#imgUrl",function(e){getImgUrl()}),mui(".sub-mes").on("tap","#goback",function(e){0===CLICKTAG&&(""===document.getElementById("imgUrl").src?mui.alert("请先拍照再提交打卡","","我知道了",function(){}):"yes"===iscenter?(CLICKTAG=1,e.disabled=!0,getPkid()):mui.alert(errorMessage,"","我知道了",function(){}))}),mui(".icon-view").on("tap",".mui-icon",function(e){$lemix.ui.navigation.pop()});</script></body></html>